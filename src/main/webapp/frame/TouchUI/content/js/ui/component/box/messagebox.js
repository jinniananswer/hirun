/*!
 * MessageBox
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(e,t,n){"use strict";function o(t){var n,o,i;if(t&&e.isString(t)){var s=t.substring(0,t.indexOf("\n"));s=s.split("|"),s&&s.length>3&&(n=s[0],o=s[1],i=s[2]),s=null}return{EXCE_LEVEL:n,ERROR_LEVEL:o,ERROR_ID:i}}function i(t){if(t&&t.nodeType)for(var n=0,o=t;n<5&&o&&o.nodeType;){if(1==o.nodeType&&e.nodeName(o,"button"))return o;o=o.parentNode,n++}}if(e&&"undefined"==typeof e.MessageBox){var s=200,a=Array.prototype.push,r=Array.prototype.splice,l=e.os.phone||!0===e.ratioPhone,d=!e.os.pad&&!e.os.phone&&e.browser.msie,u=1,p={ok:e.lang.get("ui.component.messagebox.buttontext.ok"),cancel:e.lang.get("ui.component.messagebox.buttontext.cancel"),ext0:e.lang.get("ui.component.messagebox.buttontext.ext0"),ext1:e.lang.get("ui.component.messagebox.buttontext.ext1"),ext2:e.lang.get("ui.component.messagebox.buttontext.ext2"),report:e.lang.get("ui.component.messagebox.buttontext.report")},c={fullMode:!0,showDetail:!0},g=[],f={};if(c.DialogManager={get:function(t){if(t&&e.isString(t))return f[t]},first:function(){if(g.length>0)return f[g[0]]},last:function(){if(g.length>0)return f[g[g.length-1]]},add:function(t,n){t&&e.isString(t)&&n&&(e.inArray(t,g)>-1||(a.call(g,t),f[t]=n))},remove:function(t){t&&e.isString(t)&&(r.call(g,e.inArray(t,g),1),delete f[t])}},c.Dialog=function(t){var n=this;t&&e.isObject(t)&&e.extend(n,t),n.id||(n.id="wade_messagebox-"+ ++u),n._init(),n.constructor.call(n),c.DialogManager.add(n.id,n)},c.Dialog.prototype=e.extend(new e.UIComponent,{show:function(){var t=this;if(t.el&&t.el.nodeType&&(t.el.style.display=""),t.el.style.zIndex=t.zIndex?t.zIndex:e.zIndexer.get(t.id),!e.os.pad&&!l){var n=e("#"+t.id+"_btns").children("button[tag=ok]");if(n.length>0)n.focus();else{var o=e("#"+t.id+"_btns").children("button[tag=cancel]");o.length>0?o.focus():e("#"+t.id+"_btns button:first").focus(),o=null}n=null}},hide:function(){var t=this;t.el&&t.el.nodeType&&(t.el.style.display="none"),t.zIndex||e.zIndexer.remove(t.id)},dragStart:function(t,o,i){var s=this;if(!t||!t.nodeType||!e.nodeName(t,"div"))return!1;var a="wrapper"==e.attr(t,"className")&&s.id==e.attr(t.parentNode,"id");if(!a)return!1;var r=(n.body.offsetWidth,n.body.offsetHeight,s.wrapperDiv.offsetWidth),l=s.wrapperDiv.offsetHeight,d=s.wrapperDiv.offsetLeft,u=s.wrapperDiv.offsetTop,p=o-d,c=i-u;return!(p<=0||c<=0)&&(s.dragContentWidth=r,s.dragContentHeight=l,s.dragDistX=p,s.dragDistY=c,"absolute"!=s.wrapperDiv.style.position&&(s.wrapperDiv.style.position="absolute",s.wrapperDiv.style.left=d+"px",s.wrapperDiv.style.top=u+"px"),!0)},dragMove:function(e,t){var o=this,i=e,s=t,a=n.body.offsetWidth,r=n.body.offsetHeight,l=a-o.dragContentWidth,d=r-o.dragContentHeight;i-=o.dragDistX,s-=o.dragDistY,i<0&&(i=0),s<0&&(s=0),i>l&&(i=l),s>d&&(s=d),o.wrapperDiv.style.left=i+"px",o.wrapperDiv.style.top=s+"px"},dragEnd:function(){},destroy:function(){var t=this;if(t.zIndex||e.zIndexer.remove(t.id),e(t.wrapperDiv).remove(),c.DialogManager.remove(t.id),t.buttons){for(var n in t.buttons)delete t.buttons[n];t.buttons=null}t.msg=null,t.content=null,t.detail=null,t.fn=null,t.beforeHide=null,t.btnShowDetail=null,t.btnDiv=null,t.el=null},_init:function(){var t=this;"undefined"==typeof t.full&&(t.full=c.fullMode),"undefined"==typeof t.showDetail&&(t.showDetail=c.showDetail),t.msg||(t.msg=""),t.content||(t.content="");var s=e.extend({},t.buttons);e.extend(t,o(t.detail)),t.report=("DEBUG"==t.ERROR_LEVEL||"LOG"==t.ERROR_LEVEL)&&t.ERROR_ID,(t.alert||t.error)&&t.report&&(t.content+="<br />"+e.lang.get("ui.component.messagebox.report.errorid-label")+'ï¼š<span id="'+t.id+'_errorid_text">'+t.ERROR_ID+"</span>",s.report=""+p.report+",send");var a=[];a.push('<div id="'+t.id+'" x-wade-uicomponent="messagebox" class="'+t._getClassName()+'" style="display:none;">'),a.push('<div class="wrapper">'),a.push('<div class="emote"></div>'),a.push('<div class="info">'),a.push('<div class="text">'),a.push('<div id="'+t.id+'_title" class="title">'+t.msg+"</div>"),a.push('<div id="'+t.id+'_ct" class="content">'),a.push(t.content),(t.alert||t.error)&&t.detail&&(a.push('<p><span id="'+t.id+'_show_detail" class="e_blue" style="cursor: pointer;">'),t.showDetail?a.push(e.lang.get("ui.component.messagebox.buttontext.hide-detail")):a.push(e.lang.get("ui.component.messagebox.buttontext.show-detail")),a.push("</span></p>")),a.push("</div>"),a.push("</div>"),(t.alert||t.error)&&t.detail&&(a.push('<div id="'+t.id+'_detai_div" class="detail" style="max-width:60em;'+(t.showDetail?"":"display:none;")+'">'),a.push('<div class="text"><pre id="'+t.id+'_detail_text">'+t.detail+"</pre></div>"),a.push("</div>"),t.report&&(a.push('<div id="'+t.id+'_report_cond" style="display:none">'),a.push('<input type="hidden" name="ERROR_ID" value="'+t.ERROR_ID+'" />'),a.push('<input type="hidden" name="TRACE_ID" value="" />'),a.push('<textarea name="ERROR_INFO" style="width:0px;height:0px;display:none;">'+t.detail+"</textarea>"),a.push("</div>"))),a.push('<div id="'+t.id+'_btns" class="fn">');var r,l,u;for(var g in s)if(l=p[g])if(r=s[g],r&&e.isBoolean(r)&&(r=l),"ok"==g||"cancel"==g)a.push('<button type="button" tag="'+g+'" class="e_button-'+("ok"==g?"green":"navy")+' e_button-r"><span class="e_ico-'+("ok"==g?"ok":"close")+'"></span><span>'+r+"</span></button>");else if(r&&e.isString(r)){u=r.split(",");var f=u&&u.length>2?u[2]:"e_button-blue e_button-r";a.push('<button type="button" tag="'+g+'" class="'+f+'">'),u&&2==u.length&&(a.push('<span tag="ico" class="e_ico-'+u[1]+'"></span>'),r=u[0]),a.push('<span tag="text">'+r+"</span></button>")}if(r=l=u=null,(t.alert||t.error)&&t.detail){r=s.copydetail;var f="e_button-green e_button-r";r&&e.isString(r)&&(u=r.split(",")),u&&u.length>2&&(f=u[2]),a.push('<button type="button" tag="copydetail" class="'+f+'">'),u&&2==u.length?(a.push('<span tag="ico" class="e_ico-'+u[1]+'"></span>'),r=u[0]):(a.push('<span tag="ico" class="e_ico-'+(d?"copy":"select")+'"></span>'),r=d?e.lang.get("ui.component.messagebox.buttontext.copy-all"):e.lang.get("ui.component.messagebox.buttontext.select-all")),a.push('<span tag="text">'+r+"</span></button>")}a.push("</div>"),a.push("</div>"),a.push("</div>"),a.push("</div>"),e(n.body).append(a.join("")),a=null,t.el=n.getElementById(t.id),t.wrapperDiv=e("div.wrapper:first",t.el)[0],t.btnDiv=n.getElementById(t.id+"_btns"),t.btnShowDetail=n.getElementById(t.id+"_show_detail"),t.btnDiv&&e(t.btnDiv).tap(function(n){n.originalEvent&&(n=e.event.fix(n.originalEvent));var o=n.target;o&&o.nodeType&&t._buttonCallback(i(o))}),t.btnShowDetail&&e(t.btnShowDetail).tap(function(n){var o=e("#"+t.id+"_detai_div");o.length&&("none"==o.css("display")?(o.css("display",""),e(this).text(e.lang.get("ui.component.messagebox.buttontext.hide-detail"))):(o.css("display","none"),e(this).text(e.lang.get("ui.component.messagebox.buttontext.show-detail"))))})},_getClassName:function(){var e=this,t="c_msg c_msg-h c_msg-phone-v";return t+=e.full?" c_msg-full":" c_msg-popup",e.alert?t+=" c_msg-warn":e.confirm?t+=" c_msg-help":e.error?t+="warn"==e.EXCE_LEVEL?" c_msg-warn":" c_msg-error":e.success&&(t+=" c_msg-success"),t},_triggerDefaultButton:function(){var t=this,n=e("#"+t.id+"_btns button:first");n.length&&t._buttonCallback(n[0]),n=null},_buttonCallback:function(t){var n=this;if(t&&1==t.nodeType){var o=e.attr(t,"tag");if("copydetail"==o)n._copyDetail();else if("report"==o)n._reportDetail();else{var i=!0;if(n.beforeHide&&e.isFunction(n.beforeHide)&&(i=n.beforeHide(o)),!1===i)return;n.hide(),n.fn&&e.isFunction(n.fn)&&n.fn(o)}}},_updateDetail:function(t){var n=this;t&&e.isString(t)&&(e.extend(n,o(n.detail)),e("#"+n.id+"_errorid_text").html(n.ERROR_ID),e("#"+n.id+"_detail_text").html(t),e("#"+n.id+"_report_cond").children("input[name=ERROR_ID]:first").val(n.ERROR_ID),e("#"+n.id+"_report_cond").children("textarea[name=ERROR_INFO]:first").val(t))},_copyDetail:function(){var e=this,o=n.getElementById(e.id+"_detail_text");if(o&&o.nodeType){var i=n.getElementById(e.id+"_detai_div");if(i&&i.nodeType&&"none"!=i.style.display)if(n.selection){var s=n.body.createTextRange();s.moveToElementText(o),s.moveEnd("character"),s.select()}else{var a=t.getSelection(),s=document.createRange();s.selectNodeContents(o),a.removeAllRanges(),a.addRange(s)}i=null,d&&clipboardData.setData("text",o.innerText),o=null}},_reportDetail:function(){var n=this,o=t.wadeExceptionReporter;o&&e.isString(o)&&e.httphandler.submit(n.id+"_report_cond",o,"report",null,function(){c.success("",e.lang.get("ui.component.messagebox.report.success")),e.endLoading()},function(t,n){c.error("",e.lang.get("ui.component.messagebox.report.error")+":<br />"+t+"<br />"+n),e.endLoading()})}}),e.extend(c,{confirm:function(t,n,o,i){return this.show({msg:t,content:n,confirm:!0,fn:o,buttons:e.extend({cancel:!0,ok:!0},i)})},success:function(t,n,o,i){return this.show({msg:t,content:n,success:!0,fn:o,buttons:e.extend({ok:!0},i)})},alert:function(t,n,o,i,s){return o&&e.isString(o)&&(s=o),this.show({msg:t,content:n,alert:!0,fn:o,buttons:e.extend({ok:!0},i),detail:s})},error:function(t,n,o,i,s){return o&&e.isString(o)&&(s=o),this.show({msg:t,content:n,error:!0,fn:o,buttons:e.extend({cancel:!0},i),detail:s})},show:function(t){var n,o,i,s=[];if(t){if(s.push(t.msg),s.push(t.content),s.push(t.error),s.push(t.success),s.push(t.alert),s.push(t.confirm),s.push(t.fn&&e.isFunction(t.fn)?t.fn.toString():null),t.buttons&&e.isPlainObject(t.buttons))for(var a in t.buttons)s.push(a),s.push(t.buttons[a]);i=e.md5(s.join("")),o=t.id="wade_messagebox-"+i,s=null}return n=o?c.DialogManager.get(o):null,n?n._updateDetail(t.detail):n=new c.Dialog(t),n.show(),n}}),!e.os.pad&&!l){e(n).keydown(function(t){if(13==t.keyCode||108==t.keyCode){var n=t.target;if(n&&1==n.nodeType&&(e.nodeName(n,"input")||e.nodeName(n,"textarea")))return;var o=c.DialogManager.last();o&&o._triggerDefaultButton()}});var h,b,v,m=!1,_=!1,x=null;e(n).mousedown(function(e){c.fullMode||0!=e.button&&1!=e.button||(m=_=!1,h=e.target,b=e.pageX,v=e.pageY,x=t.setTimeout(function(){var e=c.DialogManager.last();e&&(m=e.dragStart(h,b,v)),m&&(n.body.style.cursor="move")},s))}),e(n).mousemove(function(e){if(!(c.fullMode||0!=e.button&&1!=e.button)&&m){_=!0;var t=c.DialogManager.last();t&&t.dragMove(e.pageX,e.pageY)}}),e(n).mouseup(function(e){c.fullMode||0!=e.button&&1!=e.button||(h=b=v=null,x&&t.clearTimeout(x),m&&(m=_=!1,n.body&&(n.body.style.cursor="")))})}t.MessageBox=e.MessageBox=c}}(window.Wade,window,document);