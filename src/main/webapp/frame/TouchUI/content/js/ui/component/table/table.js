/*!
 * table component
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(e,l,t){"use strict";if(e&&"undefined"==typeof e.Table){var a=Array.prototype.push,o=(Array.prototype.splice,e.os.phone||!0===e.ratioPhone),i=/^[0-9]+$/,n=/<\/?.+?>/g,d={add:"0",upd:"2",del:"1"},r="_nocol",s=[],f=function(l,a){var o=this;o.el=l&&1==l.nodeType?l:t.getElementById(l),o.el&&o.el.nodeType&&(o.id=e.attr(o.el,"id"))&&(a&&e.isObject(a)&&e.extend(o,a),e.attr(o.el,"x-wade-uicomponent")||e.attr(o.el,"x-wade-uicomponent","table"),o._init(),o.constructor.call(o))};f.prototype=e.extend(new e.UIComponent,{getData:function(l,t){var a=this;if(!a.head||!a.bodyTableBody)return null;l&&e.isString(l)&&(t=l,l=!1),t&&e.isString(t)&&(t=","+t+",");var o,i,n,d,s=new e.DatasetList;return e.each(a.bodyTableBody.rows,function(f,u){if(d=e.attr(u,"status"),(void 0==d||null==d)&&(d="",!0!==l))return!0;var c=new e.DataMap;for(o in a.head)0!=o.indexOf(r)&&(n=a.head[o][0],void 0!=n&&(!t||t.indexOf(","+o+",")>-1)&&(i=u.cells[n],c.put(o,h(i))));c.put("tag",d),s.add(c)}),o=i=n=null,s},getRowData:function(l,t){var a=this;if(!i.test(l))return null;if(!a.head||!a.bodyTableBody)return null;t&&e.isString(t)&&(t=","+t+",");var o=a.bodyTableBody.rows[l];if(!o||!o.nodeType)return null;var n,d,s,f=new e.DataMap,u=e.attr(o,"status");void 0!=u&&null!=u||(u="");for(n in a.head)0!=n.indexOf(r)&&(s=a.head[n][0],void 0!=s&&(!t||t.indexOf(","+n+",")>-1)&&(d=o.cells[s],f.put(n,h(d))));return f.put("tag",u),n=d=s=null,o=null,f},getSelectedRowData:function(e){var l=this;return l.getRowData(l.selected,e)},getCheckedRowsData:function(l,t){var a=this;if(!l||!e.isString(l))return null;if(!a.head||!a.bodyTableBody)return null;t&&e.isString(t)&&(t=","+t+",");var o=e("input[name="+l+"]:checked",a.bodyTableBody);if(!o.length)return null;var i,n,d,s,f,u=new e.DatasetList;return o.each(function(){if(n=c(this)){var l=new e.DataMap;f=e.attr(n,"status"),void 0!=f&&null!=f||(f="");for(i in a.head)0!=i.indexOf(r)&&(s=a.head[i][0],void 0!=s&&(!t||t.indexOf(","+i+",")>-1)&&(d=n.cells[s],l.put(i,h(d))));l.put("tag",f),u.add(l)}}),i=d=s=n=o=null,u},addRow:function(l,t){var a=this;if(e.isObject(l)&&!e.isEmptyObject(l)&&a.head&&a.bodyTableBody){var o,n=l._className?l._className:"new",s=[];s.push('<tr status="'+d.add+'" '),n&&e.isString(n)&&s.push(' class="'+n+'" '),s.push(" >");for(var f in a.head)n=a.head[f][1],o=a.head[f][2],s.push("<td"+(n?' class="'+n+'" ':"")+(!1===o?' style="display:none;" ':"")+">"),0!=(""+f).indexOf(r)&&s.push(l.hasOwnProperty(f)?l[f]:""),s.push("</td>");s.push("</tr>"),!0===t?(i.test(a.selected)&&a.selected++,e(a.bodyTableBody).prepend(s.join(""))):e(a.bodyTableBody).append(s.join("")),s=null,a.scroller&&a.scroller.refresh(),setTimeout("window['"+a.id+"'].adjust();",1)}},deleteRow:function(l,t){var a=this;if(l&&1==l.nodeType)return void a.deleteRow(e.inArray(c(l),a.bodyTableBody.rows));if(i.test(l)&&!(l<0)&&a.bodyTableHead&&a.bodyTableBody){var o=a.bodyTableBody.rows[l];if(!o||!o.nodeType)return;var n,r=e.attr(o,"status");void 0==r||d.upd==r?(e.attr(o,"status",d.del),n=o.className?o.className:"",(" "+n+" ").indexOf(" deleted ")<0&&(o.className=e.trim(n+" deleted")),!0!==t?o.style.display="none":e(o).remove()):d.add==r&&e(o).remove(),a.selected==l&&(a.selected=null),r=n=null,o=null,a.scroller&&a.scroller.refresh()}},updateRow:function(l,t){var a=this;if(i.test(t)&&e.isObject(l)&&!e.isEmptyObject(l)&&a.head&&a.bodyTableBody){var o=a.bodyTableBody.rows[t];if(o&&o.nodeType){var n,s,f,u=e.attr(o,"status");for(n in a.head)0!=n.indexOf(r)&&(f=a.head[n][0],s=o.cells[f],s&&s.nodeType&&l.hasOwnProperty(n)&&(s.innerHTML=l[n]));d.add!=u&&e.attr(o,"status",d.upd),n=s=f=null,o=null}}},isPrimary:function(l,t,a){var o=this;if(!l||!e.isString(coles))return!1;if(!t||!e.isPlainObject(t))return!1;var n=l.split(","),d="";if(e.each(n,function(e,l){d+=t[l]}),!i.test(a)){if(!o.bodyTableBody)return!1;var r,s,f=!1;return e.each(o.bodyTableBody.rows,function(t,a){if(r=o.getRowData(t,l))return e.each(n,function(e,l){s+=r[l]}),s==d?(f=!0,!1):d==s}),f}var r=o.getRowData(a,l);if(r){var s="";return e.each(n,function(e,l){s+=r[l]}),d==s}return!1},adjust:function(){var e=this;o||(e.fixedTop(!0),e.fixedColumns(!0)),e.scroller&&e.scroller.refresh()},fixedTop:function(l){var t=this;if(t.fixedMode&&!o&&t.bodyTableHead){!0!==l&&(t.topTableHead.style.display="none",e(t.topTableHead).html(t.bodyTableHead.innerHTML),t.topTableHead.style.display="");var a;e("tr",t.bodyTableHead).each(function(l){a=t.topTableHead.rows[l],e("th",this).each(function(e){a.cells[e].style.width=this.offsetWidth+"px"})}),a=null}},fixedColumns:function(l){var t=this;if(t.fixedMode&&!o){var a=0+(t.fixedLeftCols?t.fixedLeftCols:0)+(t.fixedRightCols?t.fixedRightCols:0);if(t.bodyTableBody&&t.bodyTableBody.rows){var i=t.bodyTableBody.rows.length;if(!(i<=0)){var n=t.bodyTableBody.rows[0].cells.length;if(!(n<=0||n<a)){var d,r,s=document.createElement("div");s.style.display="none";var f,u=0,c=0,b=0,h=0;if(!0!==l){var p=[],T=[];for(u=0,b=t.bodyTableHead.rows.length;u<b;u++){if(d=t.bodyTableHead.rows[u],t.fixedLeftCols){for(p.push("<tr>"),c=0;c<t.fixedLeftCols;c++)r=d.cells[c],r&&(r=r.cloneNode(!0),s.appendChild(r),p.push(s.innerHTML),s.removeChild(r));p.push("</tr>")}if(t.fixedRightCols){for(T.push("</tr>"),c=0;c<t.fixedRightCols;c++)f=n-c-1,r=d.cells[f],r&&(r=r.cloneNode(!0),s.appendChild(r),T.splice(0,0,s.innerHTML),s.removeChild(r));T.splice(0,0,"<tr>")}}for(t.fixedLeftCols&&(e(t.leftTableHead).html(p.join("")),e(t.leftTopTableHead).html(p.join(""))),t.fixedRightCols&&(e(t.rightTableHead).html(T.join("")),e(t.rightTopTableHead).html(T.join(""))),p=[],T=[],u=0,b=t.bodyTableBody.rows.length;u<b;u++){if(d=t.bodyTableBody.rows[u],t.fixedLeftCols){for(p.push("<tr>"),c=0;c<t.fixedLeftCols;c++)r=d.cells[c],r&&(r=r.cloneNode(!0),s.appendChild(r),p.push(s.innerHTML),s.removeChild(r));p.push("</tr>")}if(t.fixedRightCols){for(T.push("</tr>"),c=0;c<t.fixedRightCols;c++)f=n-c-1,r=d.cells[f],r&&(r=r.cloneNode(!0),s.appendChild(r),T.splice(0,0,s.innerHTML),s.removeChild(r));T.splice(0,0,"<tr>")}}t.fixedLeftCols&&(t.leftTableBody.innerHTML=p.join(""),t.left.style.display="",t.leftTop.style.display=""),t.fixedRightCols&&(t.rightTableBody.innerHTML=T.join(""),t.right.style.display="",t.rightTop.style.display=""),p=T=null}var y,g;for(u=0,b=t.bodyTableHead.rows.length;u<b;u++){if(d=t.bodyTableHead.rows[u],t.fixedLeftCols)for(c=0;c<t.fixedLeftCols;c++)r=d.cells[c],r&&(h=r.offsetWidth+"px",(y=t.leftTableHead.rows[u])&&(g=y.cells[c])&&(g.style.width=h),(y=t.leftTopTableHead.rows[u])&&(g=y.cells[c])&&(g.style.width=h));if(t.fixedRightCols)for(c=0;c<t.fixedRightCols;c++)f=n-c-1,r=d.cells[f],r&&(f=t.fixedRightCols-c-1,h=r.offsetWidth+"px",(y=t.leftTableHead.rows[u])&&(g=y.cells[f])&&(g.style.width=h),(y=t.leftTopTableHead.rows[u])&&(g=y.cells[f])&&(g.style.width=h))}r=s=null}}}}},fillDataTitle:function(){var l=this;if(o){var t,a=l.bodyTableHead.rows[0];a&&a.nodeType&&(e("tr",l.bodyTableBody).each(function(l){e("td",this).each(function(l){t=a.cells[l],t&&t.nodeType&&(e.attr(this,"data-title",e.trim(e.text(t))),(" "+t.className+" ").indexOf(" key ")>-1&&(this.className=e.trim((this.className?this.className:"")+" key")))})}),t=a=null)}},destroy:function(){var e=this;if(e.tdClip&&(e.tdClip.destroy(),e.tdClip=null),e.rowClip&&(e.rowClip.destroy(),e.rowClip=null),e.cellClip&&(e.cellClip.destroy(),e.cellClip=null),e.head){for(var l in e.head)delete e.head[l];e.head=null}e.scroller&&e.scroller.destroy(),e.bodyTableHead=null,e.bodyTableBody=null,e.bodyTable=null,e.wrapper=null,e.body=null,e.topTableHead=null,e.topTable=null,e.top=null,e.leftTableHead=null,e.leftTableBody=null,e.leftTable=null,e.left=null,e.rightTableHead=null,e.rightTableBody=null,e.rightTable=null,e.right=null,e.leftTopTableHead=null,e.leftTopTable=null,e.leftTop=null,e.rightTopTableHead=null,e.rightTopTable=null,e.rightTop=null,e.el=null},_init:function(){var t=this;t.body=e(t.el).children("div.body:first")[0],t.wrapper=e(t.body).children("div.producer:first")[0],t.bodyTable=e(t.wrapper).children("table:first")[0],t.bodyTableHead=t.bodyTable.tHead,t.bodyTableBody=t.bodyTable.tBodies&&t.bodyTable.tBodies.length>0?t.bodyTable.tBodies[0]:null,t.top=e(t.el).children("div.top:first")[0],t.topTable=e(t.top).children("table:first")[0],t.topTableHead=t.topTable.tHead,t.left=e(t.el).children("div.left:first")[0],t.leftTable=e(t.left).children("table:first")[0],t.leftTableHead=t.leftTable.tHead,t.leftTableBody=t.leftTable.tBodies&&t.leftTable.tBodies.length>0?t.leftTable.tBodies[0]:null,t.right=e(t.el).children("div.right:first")[0],t.rightTable=e(t.right).children("table:first")[0],t.rightTableHead=t.rightTable.tHead,t.rightTableBody=t.rightTable.tBodies&&t.rightTable.tBodies.length>0?t.rightTable.tBodies[0]:null,t.leftTop=e(t.el).children("div.leftTop:first")[0],t.leftTopTable=e(t.leftTop).children("table:first")[0],t.leftTopTableHead=t.leftTopTable.tHead,t.rightTop=e(t.el).children("div.rightTop:first")[0],t.rightTopTable=e(t.rightTop).children("table:first")[0],t.rightTopTableHead=t.rightTopTable.tHead,t.bodyTableHead&&(t.head=b(t.bodyTableHead,!0)),o||e.os.pad?t.scroller||(t.scroller=new e.Scroll(t.body,{bounce:t.bounce,momentum:t.momentum,checkDOMChanges:t.checkDOMChanges,onPosition:function(e,l,a,o){this.options.useTransform?(t.top.style[a]="translate("+e+"px,0px) scale("+this.scale+")"+o,t.fixedLeftCols&&(t.left.style[a]="translate(0px,"+l+"px) scale("+this.scale+")"+o),t.fixedRightCols&&(t.right.style[a]="translate(0px,"+l+"px) scale("+this.scale+")"+o)):(e=m.round(e),t.top.style.left=e+"px")}})):e(t.body).bind("scroll",function(){var e=t.body.scrollLeft;"undefined"!=typeof e&&(t.top.style.left=0-e+"px")}),e.inArray(t.id,s)<0&&a.call(s,t.id),e(function(){t.fixedTop()}),t.bodyTableBody&&t.editMode&&e(t.el).tap(function(l){if(l.originalEvent&&(l=e.event.fix(l.originalEvent)),l.target){var a=u(l.target);if(a){var o,n=a.parentNode;if(i.test(t.selected)){var d=t.bodyTableBody.rows[t.selected];d&&d.nodeType&&(o=d.className?d.className:"",(" "+o+" ").indexOf(" on ")>-1&&(d.className=e.trim((" "+o+" ").replace(/ on /g," ")))),t.fixedLeftCols&&(d=t.leftTableBody.rows[t.selected],d&&d.nodeType&&(o=d.className?d.className:"",(" "+o+" ").indexOf(" on ")>-1&&(d.className=e.trim((" "+o+" ").replace(/ on /g," "))))),t.fixedRightCols&&(d=t.rightTableBody.rows[t.selected],d&&d.nodeType&&(o=d.className?d.className:"",(" "+o+" ").indexOf(" on ")>-1&&(d.className=e.trim((" "+o+" ").replace(/ on /g," "))))),d=null}n.parentNode==t.bodyTableBody?t.selected=e.inArray(n,t.bodyTableBody.rows):t.fixedLeftCols&&n.parentNode==t.leftTableBody?t.selected=e.inArray(n,t.leftTableBody.rows):t.fixedRightCols&&(t.selected=e.inArray(n,t.rightTableBody.rows)),i.test(t.selected)&&((n=t.bodyTableBody.rows[t.selected])&&(o=n.className?n.className:"",(" "+o+" ").indexOf(" on ")<0&&(n.className=e.trim(o+" on"))),t.fixedLeftCols&&(n=t.leftTableBody.rows[t.selected])&&(o=n.className?n.className:"",(" "+o+" ").indexOf(" on ")<0&&(n.className=e.trim(o+" on"))),t.fixedRightCols&&(n=t.rightTableBody.rows[t.selected])&&(o=n.className?n.className:"",(" "+o+" ").indexOf(" on ")<0&&(n.className=e.trim(o+" on")))),o=null,a=n=null}}}),(o||e.os.pad)&&e(t.el).bind("selectstart",function(e){return e.stop(),!1}),e(l).bind("onorientationchange"in l?"orientationchange":"resize",function(){t.adjust()})}});var u=function(l){if(!l||!l.nodeType)return null;for(var t=0,a=l;t<5&&a&&a.nodeType;){if(1==a.nodeType&&e.nodeName(a,"td"))return a;a=a.parentNode,t++}},c=function(l){if(l&&l.nodeType)for(var t=0,a=l;t<5&&a&&a.nodeType;){if(1==a.nodeType&&e.nodeName(a,"tr"))return a;a=a.parentNode,t++}},b=function(l,t){if(!l||!l.nodeType||!e.nodeName(l,"thead"))return null;var a=l.getElementsByTagName("tr")[0];if(!a||!a.nodeType)return null;var o,i,n,d,s,f={},u=a.getElementsByTagName("th");if(u&&u.length>0)for(o=0;o<u.length;)i=u[o],n=e.attr(i,"col"),d=i.className?i.className:"",s="none"!=i.style.display,(n||!0===t&&(n=r+"_"+o))&&(f[n]=[o,d,s]),o++;return i=a=u=d=null,f},h=function(l){return l&&l.nodeType?e.browser.msie?e.trim(l.innerText):e.trim((""+l.innerHTML).replace(n,"")):null},p=function(l){if(l&&e.isString(l)){var t="&partids=",a=l.indexOf(t);if(!(a<0)){var o=l.substring(a+t.length);if(o)return a=o.indexOf("&"),a>0&&(o=o.substring(0,a)),o}}};e.extend(f,{adjust:function(){if(s.length>0)for(var e,t=0,a=s.length;t<a;t++)e=s[t],l[e]&&l[e].adjust()}}),e.extend({getTableData:function(t){var a=t&&e.isString(t)?l[t]:null;if(a)return a.getData()},getTableRowData:function(t,a){var o=t&&e.isString(t)?l[t]:null;if(o)return o.getRowData(a)},addTableRow:function(t,a){var o=t&&e.isString(t)?l[t]:null;if(o)return o.addRow(a)},deleteTableRow:function(t,a){var o=t&&e.isString(t)?l[t]:null;if(o)return o.deleteRow(a)},updateTableRow:function(t,a){var o=t&&e.isString(t)?l[t]:null;if(o)return o.updateRow(a)}}),e.each("getTableData,getTableRowData,addTableRow,deleteTableRow,updateTableRow".split(","),function(t,a){l[a]=e[a]}),e(t).ajaxSuccess(function(t,a,i){if(i&&i.url&&e.isString(i.url)){var n=p(i.url);if(n){for(var d,r,s,u,c=n.split(","),b=0;b<c.length;b++)(d=c[b])&&(u=e("#"+d+" div[x-wade-uicomponent=table]"),u.length&&u.each(function(){s=e.attr(this,"id"),s&&(r=l[s])&&r instanceof f&&(r.fixedTop(!0),(r.fixedLeftCols||r.fixedRightCols)&&r.fixedColumns(),o&&r.fillDataTitle())}));s=u=null,n=c=d=null}}}),l.Table=e.Table=f}}(window.Wade,window,document);