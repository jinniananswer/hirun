/*!
 * tabset component
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(t,e,i){"use strict";function n(t){return""===o?t:(t=t.charAt(0).toUpperCase()+t.substr(1),o+t)}if(t&&"undefined"==typeof t.Tabset){var a=Array.prototype.splice,s=Math,r=i.createElement("div").style,o=function(){for(var t,e="t,webkitT,MozT,msT,OT".split(","),i=0,n=e.length;i<n;i++)if(t=e[i]+"ransform",t in r)return e[i].substr(0,e[i].length-1);return!1}(),l=o?"-"+o.toLowerCase()+"-":"",d=n("transform"),c=n("transitionProperty"),u=n("transitionDuration"),f=n("transformOrigin"),v=n("transitionTimingFunction"),m=(n("transitionDelay"),n("perspective")in r),b="undefined"!=typeof t.hasTouch?t.hasTouch:"ontouchstart"in e,p=o!==!1,h=n("transition")in r,_="onorientationchange"in e?"orientationchange":"resize",g=b?"touchstart":"mousedown",x=b?"touchmove":"mousemove",T=b?"touchend":"mouseup",y=b?"touchcancel":"mouseup",w=function(){if(o===!1)return!1;var t={"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"otransitionend",ms:"MSTransitionEnd"};return t[o]}(),S=function(){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t){return setTimeout(t,1)}}(),I=function(){return e.cancelRequestAnimationFrame||e.webkitCancelAnimationFrame||e.webkitCancelRequestAnimationFrame||e.mozCancelRequestAnimationFrame||e.oCancelRequestAnimationFrame||e.msCancelRequestAnimationFrame||clearTimeout}(),X=m?" translateZ(0)":"",N=t.os.phone||!0===t.ratioPhone,F=1e5,L=null,E=function(e,n){var a=this;a.el=e&&1==e.nodeType?e:i.getElementById(e),a.el&&a.el.nodeType&&t.nodeName(a.el,"div")&&(a.id=t.attr(a.el,"id"))&&(n&&t.isObject(n)&&t.extend(a,n),t.attr(a.el,"x-wade-uicomponent")||t.attr(a.el,"x-wade-uicomponent","tabset"),a._init(),a.constructor.call(a))};E.prototype=t.extend(new t.UIComponent,{handleEvent:function(t){var e=this;switch(t.type){case g:if(!b&&0!==t.button)return;e._start(t);break;case x:e._move(t);break;case T:case y:e._end(t);break;case _:e._resize();break;case w:e._transitionEnd(t)}},updateTitle:function(e){var i=this;e&&t.isString(e)&&t("#"+i.id+"_tab_title_text").text(e)},updateTitleTip:function(e){var i=this;void 0!=e&&null!=e&&t("#"+i.id+"_tab_title_tip_tag").text(e)},add:function(i,n){var a=this;if(!i||!t.isString(i))return-1;if(!n||!t.isPlainObject(n))return-1;if(a.contents.length>=20)return-1;i=t.xss(i);var s=t.extend({},n),r=s.html&&t.isString(s.html),o=s.page&&t.isString(s.page);if(!r&&!o)return-1;var l=a.contents.length,d=a.id+"_"+l;t(a.tabUl).append('<li id="'+a.id+"_tab_li_"+l+'" idx="'+l+'">'+i+"</li>");var c=[];c.push('\r\n<div title="'+i+'" class="content" idx="'+l+'" style="'+(a.width?"width:"+a.width+"px":"")+'">'),r?c.push(s.html):o&&(c.push('<iframe id="frame_'+d+'" style="width:100%;height:100%;display:none" frameborder="0"></iframe>'),c.push('<div class="c_msg c_msg-full c_msg-loading">'),c.push('<div class="producer">'),c.push('<div class="emote"></div>'),c.push('<div class="info"><div class="text"><div class="title">loading</div></div></div>'),c.push("</div>"),c.push("</div>")),c.push("\r\n</div>"),t(a.page).append(c.join("")),c=null;var u=t(a.page).children("div[idx="+l+"]");u&&u.length&&(a.titles[l]=i,a.contents.push(u[0]),a.frameSize++),u=null;var f=a.el.className?a.el.className:"";return f=t.trim((" "+f+" ").replace(/ c_tab-slide-\d+ /g," "))+" c_tab-slide-"+(l+1),a.el.className=f,o&&(t.Frame||e.includeScript(t.UI_FRAME_JS,!0,!0),e["frame_"+d]=new Wade.Frame("frame_"+d,{autoInit:!1,title:i,page:s.page,listener:s.listener,params:s.params,subsys:s.subsys})),l},remove:function(e){var i=this;if(!e||!t.isString(e))return-1;i._findIdxByTitle(e)},switchTo:function(e,n,a){var r=this;if(/^\d+$/.test(e)&&r.activeIdx!=e){e=parseInt(e);var o,l;if(o=r.contents[e],o&&o.nodeType){if(!0!==a)if(r.slidable===!1||r.vertical){if(void 0!=typeof r.activeIdx){var d=r.contents[r.activeIdx];d&&d.nodeType&&(d.style.display="none")}o.style.display=""}else{var c=s.abs(e*r.width);r.useTouchSwitch?r.scrollTo(0-c,0,0):r.page.style.left=0-c+"px"}setTimeout(function(){D(o,r.id),z(o),P(o)},n?n:0)}if(l=i.getElementById(r.id+"_tab_li_"+r.activeIdx),l&&l.nodeType&&(l.className=""),l=i.getElementById(r.id+"_tab_li_"+e),l&&l.nodeType&&(l.className="on",r.tabScroller)){var u=0-l.offsetLeft;u=s.max(u,r.tabScroller.maxScrollX),r.tabScroller.scrollTo(u,0,200)}l=null,r.activeIdx=e,setTimeout(function(){t.event.trigger("afterSwitchAction",e,r.el)},n?n:0)}},switchToByTitle:function(t){var e=this;e.switchTo(e._findIdxByTitle(t))},privFrame:function(){var t=this,e=0,i=t.activeIdx-1;if(!(i<0||i>t.frameSize-1)){if(t.useTouchSwitch){var n=i*t.width,e=s.abs(s.round(t.width/2));t.scrollTo(0-s.abs(n),0,e)}return t.switchTo(i,e,!!e),!0}var a=A(t.el);if(a&&a.activeIdx>0)return a.privFrame()},nextFrame:function(){var t=this,e=t.activeIdx+1;if(!(e<0||e>t.frameSize-1)){if(t.useTouchSwitch){var i=e*t.width,n=s.abs(s.round(t.width/2));t.scrollTo(0-s.abs(i),0,n)}return t.switchTo(e,n,!!n),!0}var a=A(t.el);if(a&&a.activeIdx<a.frameSize-1)return a.nextFrame()},adjust:function(e){var i=this;if(!i.vertical){if(i.slidable!==!1){if(i.width=i.el.offsetWidth,i.contents&&i.contents.length)for(var n=0;n<i.contents.length;n++)i.contents[n].style.width=i.width+"px";if(1==e&&i.activeIdx>-1){var a=s.abs(i.activeIdx*i.width);i.useTouchSwitch?i.scrollTo(0-a,0,0):i.page.style.left=0-a+"px"}}var r=0;t(i.tab).children("div.fn").each(function(){r+=this.offsetWidth}),i.tabUlWidth=t(i.tabUl).width(),t("#"+i.id+"_move_fn").css("display",i.width-r<i.tabUlWidth?"":"none")}},destroy:function(){var t=this;e.clearInterval(t.tabLeftInterval),t.tabLeftInterval=null,e.clearInterval(t.tabRightInterval),t.tabRightInterval=null,L=null;for(var n in t.titles)delete t.titles[n];t.titles=null;for(var s=0;s<t.contents.length;s++)a.call(t.contents,s--,1);t.contents=null,t.tabScroller&&t.tabScroller.destroy(),t.page.style[d]="",t._unbind(_,e),t._unbind(g),t._unbind(x,i),t._unbind(T,i),t._unbind(y,i),t.tab=null,t.tabList=null,t.tabUl=null,t.page=null,t.el=null},_init:function(){var n=this;n.tab=t(n.el).children("div.tab:first")[0],n.tabList=t(n.tab).children("div.list:first")[0],n.tabUl=t(n.tabList).children("ul:first")[0],n.page=t(n.el).children("div.page:first")[0];var a=n.el.className?n.el.className:"";n.vertical=(" "+a+" ").indexOf(" c_tab-v ")>-1,n.scale=1,n.useTransform=p,n.useTransition=h,n.x=0,n.y=0,n.aniTime=null,n.frameSize=0,n.useTouchSwitch=!n.vertical&&n.slidable!==!1&&(b||N),n.titles={},n.contents=[],n.activeIdx=-1,n.useTouchSwitch&&(n.page.style[c]=n.useTransform?l+"transform":"top left",n.page.style[u]="0",n.page.style[f]="0 0",n.useTransition&&(n.page.style[v]="cubic-bezier(0.33,0.66,0.66,1)"),n.useTransform?n.page.style[d]="translate("+n.x+"px,"+n.y+"px)"+X:n.page.style.cssText+=";position:absolute;left:"+n.x+"px");var s,r,o,m,x,T,y;if(o=n.page.childNodes,o&&o.length>0)for(s=r=0;r<o.length;)x=o[r],x&&x.nodeType&&t.nodeName(x,"div")&&(" "+x.className+" ").indexOf(" content ")>-1&&(void 0!=y||"none"==x.style.display&&"true"!=t.attr(x,"default")||(y=s),n.slidable===!1||n.vertical?"none"!=x.style.display&&y!=s&&(x.style.display="none"):"none"==x.style.display&&(x.style.display=""),t.attr(x,"idx",s),n.contents.push(x),m=t.attr(x,"title"),m||(m=t.lang.get("ui.component.tabset.unamed.tab")+s),n.titles[s]=m,T=document.createElement("li"),T.innerHTML=m,n.tabUl.appendChild(T),t.attr(T,"id",n.id+"_tab_li_"+s),t.attr(T,"idx",s),s++),r++;if(n.frameSize=n.contents.length,n.slidable!==!1&&!n.vertical){var a=n.el.className?n.el.className:"";a=t.trim((" "+a+" ").replace(/ c_tab-slide-\d+ /g," "))+" c_tab-slide-"+s,n.el.className=a}if(void 0==y&&n.contents.length>0?(y=0,x=n.contents[0]):x=n.contents[y],t.isNumeric(y)&&(T=i.getElementById(n.id+"_tab_li_"+y),T&&T.nodeType&&(T.className="on")),D(x),o=x=T=null,n.activeIdx=y,!b&&!N){var w=[];w.push('<div id="'+n.id+'_move_fn" class="fn ctrl">'),w.push('<button id="'+n.id+'_moveleft_btn" class="e_button-r e_button-blue"><span class="e_ico-back"></span></button>'),w.push('<button id="'+n.id+'_moveright_btn" class="e_button-r e_button-blue"><span class="e_ico-next"></span></button>'),w.push("</div>");var S=t(n.tab).children("div.fn:first");S&&S.length?S.before(w.join("")):t(n.tab).append(w.join("")),S=null,w=null}t(n.page).children("div.fn:first").appendTo(n.tab),n.adjust(),(b||N)&&(n.tabScroller=new t.Scroll(n.tabList,{bounce:!0,vScroll:n.vertical,hScrollbar:!1,vScrollbar:!1})),n.slidable!==!1&&!n.vertical&&t.isNumeric(y)&&(n.page.style.left=0-y*n.width+"px"),t(n.tabUl).tap(function(e){e.originalEvent&&(e=t.event.fix(e.originalEvent));var i=e.target;if(i&&i.nodeType){var a;if(t.nodeName(i,"li")&&0==(""+t.attr(i,"id")).indexOf(n.id)&&(a=t.attr(i,"idx"))){if(!1===t.event.trigger("switchAction",a,n.el))return!1;n.switchTo(a)}}});var I=function(i){L||n.tabLeftInterval||(n.tabLeftInterval=e.setInterval(function(){var i=t(n.tabUl),a=i.css("left");a&&(a=parseInt(a)),!a||a>=F?(e.clearInterval(n.tabLeftInterval),n.tabLeftInterval=null,L=null):i.css("left",Math.min(a+5,F)+"px"),i=null},5),L=n.id)},E=function(){L||n.tabRightInterval||(n.tabRightInterval=e.setInterval(function(){var i=n.tabUl.offsetWidth,a=n.tabList.offsetWidth,s=i-a,r=t(n.tabUl),o=r.css("left");o&&(o=parseInt(o)),!o||o<=F-s?(e.clearInterval(n.tabRightInterval),n.tabRightInterval=null,L=null):r.css("left",Math.max(o-5,F-s)+"px"),r=null},5),L=n.id)};b||(t("#"+n.id+"_moveleft_btn").bind("mousedown",function(){var t=n.tabUl.offsetWidth,e=n.tabList.offsetWidth;t<e||I()}),t("#"+n.id+"_moveright_btn").bind("mousedown",function(){var t=n.tabUl.offsetWidth,e=n.tabList.offsetWidth;t<e||E()})),n.useTouchSwitch&&(n._bind(_,e),n._bind(g))},_findIdxByTitle:function(e){var i=this;if(e&&t.isString(e))for(var n in i.titles)if(i.titles[n]==e)return n},_bind:function(t,e,n){var a=this;i.addEventListener&&(e||a.page).addEventListener(t,a,!!n)},_unbind:function(t,e,n){var a=this;i.removeEventListener&&(e||a.page).removeEventListener(t,a,!!n)},_pos:function(t,e){var i=this;i.useTransform?i.page.style[d]="translate("+t+"px,"+e+"px) scale("+i.scale+")"+X:(t=s.round(t),e=s.round(e),this.page.style.left=t+"px",this.page.style.top=e+"px"),i.x=t,i.y=e},_start:function(e){var n=this,a=b?e.touches[0]:e,s=e.target;if(s){s="tagName"in s?s:s.parentNode;var r=A(s);if(!r||r!=n)return;if(1==s.nodeType&&s.nodeName&&(t.nodeName(s,"input")||t.nodeName(s,"select")||t.nodeName(s,"textarea")))return}n.useTransition&&n._transitionTime(0),n.moved=!1,n.animating=!1,n.distX=0,n.distY=0,n.absDistX=0,n.absDistY=0,n.dirX=0,n.dirY=0,n.absStartX=n.x,n.absStartY=n.y,n.startX=n.x,n.startY=n.y,n.pointX=a.pageX,n.pointY=a.pageY,n.startTime=e.timeStamp||Date.now(),n._bind(x,i),n._bind(T,i),n._bind(y,i)},_move:function(t){var e=this,i=b?t.touches[0]:t,n=i.pageX-e.pointX,a=i.pageY-e.pointY,r=e.x+n,o=(e.y+a,t.timeStamp||Date.now());if(e.pointX=i.pageX,e.pointY=i.pageY,e.distX+=n,e.distY+=a,e.absDistX=s.abs(e.distX),e.absDistY=s.abs(e.distY),!(e.absDistX<6&&e.absDistY<6)){e.moved=!0,e.dirX=n>0?-1:n<0?1:0,o-e.startTime>300&&(e.startTime=o,e.startX=e.x);var l=s.abs((e.frameSize-1)*e.width);return r>0||r<0-l?void(r=e.x+n/2):e.absDistX<e.absDistY?void(e.moved=!1):void e._pos(r,0)}},_end:function(e){var n=this;if(!b||0===e.touches.length){var a,r=(b?e.changedTouches[0]:e,(e.timeStamp||Date.now())-n.startTime,n.x);if(n._unbind(x,i),n._unbind(T,i),n._unbind(y,i),!(n.frameSize<=0)){if(!n.moved)return void n._resetPos(400);if(s.abs(n.distX)<t.format.rem2px(.8))return void n._resetPos(200,!0);if(a=r-n.absStartX,n.snapThreshold&&s.abs(a)<n.snapThreshold)return void n.scrollTo(n.absStartX,0,200);if(n.dirX<0){if(1==n.privFrame())return}else if(n.dirX>0&&1==n.nextFrame())return;n._resetPos(200)}}},_resize:function(){var t=this;t.adjust(!0)},_transitionEnd:function(t){var e=this;t.target==e.page&&(e._unbind(w),e._startAni())},_transitionTime:function(t){var e=this;t+="ms",e.page.style[u]=t},_resetPos:function(t,e){var i=this,n=s.abs((i.frameSize-1)*i.width),a=i.x>=0?0:i.x<0-n?0-n:i.x;return 1==e&&i.activeIdx>-1&&(a=0-s.abs(i.activeIdx*i.width)),a==i.x?void(i.moved&&(i.moved=!1)):void i.scrollTo(a,0,t||0)},scrollTo:function(t,e,i,n){var a,s,r=this,o=t;for(r.stop(),o.length||(o=[{x:t,y:e,time:i,relative:n}]),a=0,s=o.length;a<s;a++)o[a].relative&&(o[a].x=r.x-o[a].x,o[a].y=r.y-o[a].y),r.steps.push({x:o[a].x,y:o[a].y,time:o[a].time||0});r._startAni()},stop:function(){var t=this;t.useTransition?t._unbind(w):I(t.aniTime),t.steps=[],t.moved=!1,t.animating=!1},_startAni:function(){var t,e,i,n=this,a=n.x,r=n.y,o=Date.now();if(!n.animating){if(!n.steps.length)return void n._resetPos(400);if(t=n.steps.shift(),t.x==a&&t.y==r&&(t.time=0),n.animating=!0,n.moved=!0,n.useTransition)return n._transitionTime(t.time),n._pos(t.x,t.y),n.animating=!1,void(t.time?n._bind(w):n._resetPos(0));i=function(){var l,d,c=Date.now();return c>=o+t.time?(n._pos(t.x,t.y),n.animating=!1,void n._startAni()):(c=(c-o)/t.time-1,e=s.sqrt(1-c*c),l=(t.x-a)*e+a,d=(t.y-r)*e+r,n._pos(l,d),void(n.animating&&(n.aniTime=S(i))))},i()}}}),E.FramePage=function(){var e=this;if(t.isSameDomain(parent)&&!t.isSamePage(parent)&&parent.Wade&&parent.Wade.Tabset){var i=t.getParentIframe();i&&i.nodeType&&(e.tabset=parent.Wade.Tabset.findParentTabset(i),e.tabset&&e.tabset.useTouchSwitch&&(e.x=0,e.y=0,e._bind(g)))}},E.FramePage.prototype={handleEvent:function(t){var e=this;switch(t.type){case g:if(!b&&0!==t.button)return;e._start(t);break;case x:e._move(t);break;case T:case y:e._end(t)}},destroy:function(){var t=this;t._unbind(g),t._unbind(x,i),t._unbind(T,i),t._unbind(y,i)},_bind:function(t,n,a){var s=this;i.addEventListener&&(n||e).addEventListener(t,s,!!a)},_unbind:function(t,n,a){var s=this;i.removeEventListener&&(n||e).removeEventListener(t,s,!!a)},_start:function(e){var n=this,a=b?e.touches[0]:e,s=e.target;s&&(s="tagName"in s?s:s.parentNode,1==s.nodeType&&s.nodeName&&(t.nodeName(s,"input")||t.nodeName(s,"select")||t.nodeName(s,"textarea")))||(n.moved=!1,n.distX=0,n.absDistX=0,n.dirX=0,n.absStartX=n.x,n.startX=n.x,n.pointX=a.pageX,n.startTime=e.timeStamp||Date.now(),n._bind(x,i),n._bind(T,i),n._bind(y,i))},_move:function(t){var e=this,i=b?t.touches[0]:t,n=i.pageX-e.pointX,a=t.timeStamp||Date.now();e.pointX=i.pageX;var r=e.tabset.x+e.distX;if(e.distX+=n,e.absDistX=s.abs(e.distX),!(e.absDistX<6)){var o=s.abs((e.tabset.frameSize-1)*e.tabset.width);(r>0||r<0-o)&&(r=e.tabset.x+e.distX/2),e.moved=!0,e.dirX=n>0?-1:n<0?1:0,a-e.startTime>300&&(e.startTime=a,e.startX=e.x)}},_end:function(e){var n=this;if(!(b&&0!==e.touches.length||(n._unbind(x,i),n._unbind(T,i),n._unbind(y,i),n.tabset.frameSize<=0))){if(!n.moved)return void n.tabset._resetPos(400);if(s.abs(n.distX)<t.format.rem2px(.8))return void n.tabset._resetPos(200,!0);if(n.dirX<0){if(1==n.tabset.privFrame())return}else if(n.dirX>0&&1==n.tabset.nextFrame())return;n.tabset._resetPos(200)}}};var A=function(n){if(n&&n.nodeType){for(var a,s,r=0,o=n.parentNode,l=!1;r<30&&o!=i.body;){if(o&&o.nodeType&&t.nodeName(o,"div")&&"tabset"==t.attr(o,"x-wade-uicomponent")&&(a=t.attr(o,"id"))){l=!0;break}o=o.parentNode,r++}return l&&a&&(s=e[a])&&s instanceof E?s:void 0}},D=function(i,n){if(t.Frame&&t.isFunction(t.Frame)&&t.Frame.prototype._init){var a,s;t("iframe[x-wade-uicomponent=frame]",i).each(function(){a=t.attr(this,"id"),(s=e[a])&&s instanceof t.Frame&&(s.setAttribute("tabsetId",n),!0!==s.inited?setTimeout("window['"+a+"'].init()",1):setTimeout("window['"+a+"'].adjust()",1))})}},z=function(i){if(t.Scroller&&t.isFunction(t.Scroller)&&t.Scroller.prototype._init){var n,a;t("div[x-wade-uicomponent=scroller]",i).each(function(){n=t.attr(this,"id"),(a=e[n])&&a instanceof t.Scroller&&setTimeout("window['"+n+"'].refresh()",1)})}},P=function(i){if(t.Table&&t.isFunction(t.Table)&&t.Table.prototype._init){var n,a;t("div[x-wade-uicomponent=table]",i).each(function(){n=t.attr(this,"id"),(a=e[n])&&a instanceof t.Table&&setTimeout("window['"+n+"'].adjust()",1)})}};t.extend(E,{findParentTabset:function(t){return A(t)}}),b||t(function(){t(i.body).bind("mouseup",function(t){var i;L&&(i=e[L])&&(e.clearInterval(i.tabLeftInterval),i.tabLeftInterval=null,e.clearInterval(i.tabRightInterval),i.tabRightInterval=null),L=null})}),r=null,e.Tabset=t.Tabset=E}}(window.Wade,window,document);